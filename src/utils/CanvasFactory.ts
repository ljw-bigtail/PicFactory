import typeimg1 from "@/assets/canvasTypePic/type1.png";
import typeimg2 from "@/assets/canvasTypePic/type2.png";
import typeimg3 from "@/assets/canvasTypePic/type3.png";
// import typeimg4 from "@/assets/canvasTypePic/type4.png";
import typeimg5 from "@/assets/canvasTypePic/type5.png";
import typeimg6 from "@/assets/canvasTypePic/type6.png";
import typeimg7 from "@/assets/canvasTypePic/type7.png";
import typeimg8 from "@/assets/canvasTypePic/type8.png";
import typeimg9 from "@/assets/canvasTypePic/type9.png";
import typeimg10 from "@/assets/canvasTypePic/type10.png";
import typeimg11 from "@/assets/canvasTypePic/type11.png";
import typeimg12 from "@/assets/canvasTypePic/type12.png";
import typeimg13 from "@/assets/canvasTypePic/type13.png";
import typeimg14 from "@/assets/canvasTypePic/type14.png";
import typeimg15 from "@/assets/canvasTypePic/type15.png";

export const templateArr = [
  {
    src: typeimg1,
    qty: [2, 2],
    cells: [
      [[0, 0], [1, 1]],
      [[0, 1], [1, 2]],
      [[1, 0], [2, 1]],
      [[1, 1], [2, 2]],
    ],
  },
  {
    src: typeimg2,
    qty: [3, 2],
    cells: [
      [[0, 0], [2, 2]],
      [[2, 0], [3, 1]],
      [[2, 1], [3, 2]],
    ],
  },
  {
    src: typeimg3,
    qty: [2, 2],
    cells: [
      [[0, 0], [1, 2]],
      [[1, 0], [2, 2]],
    ],
  },
  // {
  //   src: typeimg4,
  //   qty: [2, 2],
  //   cells: [
  //     [[0, 0], [1, 1]],
  //     [[0, 1], [1, 2]],
  //     [[1, 0], [2, 2]],
  //   ],
  // },
  {
    src: typeimg5,
    qty: [4, 3],
    cells: [
      [[0, 0], [2, 2]],
      [[0, 2], [1, 3]],
      [[1, 2], [2, 3]],
      [[2, 0], [4, 2]],
      [[2, 2], [3, 3]],
      [[3, 2], [4, 3]],
    ],
  },
  {
    src: typeimg6,
    qty: [4, 3],
    cells: [
      [[0, 0], [2, 2]],
      [[0, 2], [1, 3]],
      [[1, 2], [2, 3]],
      [[2, 0], [3, 1]],
      [[3, 0], [4, 1]],
      [[2, 1], [4, 3]],
    ],
  },
  {
    src: typeimg7,
    qty: [4, 3],
    cells: [
      [[0, 0], [1, 1]],
      [[1, 0], [2, 1]],
      [[0, 1], [2, 3]],
      [[2, 0], [4, 2]],
      [[2, 2], [3, 3]],
      [[3, 2], [4, 3]],
    ],
  },
  {
    src: typeimg8,
    qty: [1, 1],
    cells: [
      [[0, 0], [1, 1]],
    ],
    default:{
      height: 1080,
      width: 1080,
    }
  },
  {
    src: typeimg9,
    qty: [4, 4],
    cells: [
      [[0, 0], [1, 1]],
      [[1, 0], [2, 1]],
      [[2, 0], [3, 1]],
      [[3, 0], [4, 1]],
      [[0, 1], [1, 2]],
      [[3, 1], [4, 2]],
      [[1, 1], [3, 3]],
      [[0, 2], [1, 3]],
      [[3, 2], [4, 3]],
      [[0, 3], [1, 4]],
      [[1, 3], [2, 4]],
      [[2, 3], [3, 4]],
      [[3, 3], [4, 4]],
    ],
  },
  {
    src: typeimg10,
    qty: [3, 3],
    cells: [
      [[0, 0], [1, 1]],
      [[1, 0], [2, 1]],
      [[2, 0], [3, 1]],
      [[0, 1], [1, 2]],
      [[1, 1], [2, 2]],
      [[2, 1], [3, 2]],
      [[0, 2], [1, 3]],
      [[1, 2], [2, 3]],
      [[2, 2], [3, 3]],
    ],
  },
  {
    src: typeimg11,
    qty: [3, 3],
    cells: [
      [[0, 0], [2, 2]],
      [[2, 0], [3, 1]],
      [[2, 1], [3, 2]],
      [[0, 2], [1, 3]],
      [[1, 2], [2, 3]],
      [[2, 2], [3, 3]],
    ],
  },
  {
    src: typeimg12,
    qty: [3, 3],
    cells: [
      [[0, 0], [1, 1]],
      [[1, 0], [2, 1]],
      [[2, 0], [3, 1]],
      [[0, 1], [1, 2]],
      [[0, 2], [1, 3]],
      [[1, 1], [3, 3]],
    ],
  },
  {
    src: typeimg13,
    qty: [3, 3],
    cells: [
      [[0, 0], [1, 1]],
      [[1, 0], [2, 1]],
      [[2, 0], [3, 1]],
      [[2, 1], [3, 2]],
      [[2, 2], [3, 3]],
      [[0, 1], [2, 3]],
    ],
  },
  {
    src: typeimg14,
    qty: [3, 3],
    cells: [
      [[0, 0], [2, 3]],
      [[2, 0], [3, 1]],
      [[2, 1], [3, 2]],
      [[2, 2], [3, 3]],
    ],
  },
  {
    src: typeimg2,
    qty: [4, 2],
    cells: [
      [[0, 0], [3, 2]],
      [[3, 0], [4, 1]],
      [[3, 1], [4, 2]],
    ],
  },
  {
    src: typeimg14,
    qty: [4, 3],
    cells: [
      [[0, 0], [3, 3]],
      [[3, 0], [4, 1]],
      [[3, 1], [4, 2]],
      [[3, 2], [4, 3]],
    ],
  },
  {
    src: typeimg15,
    qty: [3, 6],
    cells: [
      [[0, 0], [2, 4]],
      [[0, 4], [1, 6]],
      [[1, 4], [2, 6]],
      [[2, 0], [3, 3]], 
      [[2, 3], [3, 6]],
    ],
  },
];

export const DefaultCellOptions = {
  min_box_padding: 20, // px editor__box 与 editor__element 的最小间距 (编辑框与外部的最小间距)
  element_padding: 30, // px editor__element 的 padding 在 options.padding = 100% 时的值
  cell_margin: 30, // px editor__cell 的 margin 在 options.margin = 100% 时的值
  element_radius: .5, // 50% 最大为短边圆角拉满 editor__element 的 border-radius 在 options.radius = 100% 时的值
};

export const DefaultCanvasFactoryOptions = {
  width: 1200,
  height: 1200,
  padding: 0,
  margin: 0.2,
  radius: 0,
  template: 0,
  rule: 2,
};

export const DefaultCanvasImgOptions = {
  scale: 0,
};
export const DefaultCanvasStickerOptions = {
  scale: 1,
  width: 120,
  height: 120,
};
export const DefaultCanvasTextOptions = {
  size: 0,
  color: "#000000",
};

import sticker_1_1 from "@/assets/sticker/pixel/1.svg";
import sticker_1_2 from "@/assets/sticker/pixel/2.svg";
import sticker_1_3 from "@/assets/sticker/pixel/3.svg";
import sticker_1_4 from "@/assets/sticker/pixel/4.svg";
import sticker_1_5 from "@/assets/sticker/pixel/5.svg";
import sticker_1_6 from "@/assets/sticker/pixel/6.svg";
import sticker_1_7 from "@/assets/sticker/pixel/7.svg";

import sticker_2_1 from "@/assets/sticker/clothes/1.svg";
import sticker_2_2 from "@/assets/sticker/clothes/2.svg";
import sticker_2_3 from "@/assets/sticker/clothes/3.svg";
import sticker_2_4 from "@/assets/sticker/clothes/4.svg";
import sticker_2_5 from "@/assets/sticker/clothes/5.svg";
import sticker_2_6 from "@/assets/sticker/clothes/6.svg";
import sticker_2_7 from "@/assets/sticker/clothes/7.svg";
import sticker_2_8 from "@/assets/sticker/clothes/8.svg";
import sticker_2_9 from "@/assets/sticker/clothes/9.svg";

export const stickerArr = [
  {
    seriesName: '像素',
    key: 'pixel',
    src: [sticker_1_1,sticker_1_2,sticker_1_3,sticker_1_4,sticker_1_5,sticker_1_6,sticker_1_7]
  },
  {
    seriesName: '服饰',
    key: 'clothes',
    src: [sticker_2_1,sticker_2_2,sticker_2_3,sticker_2_4,sticker_2_5,sticker_2_6,sticker_2_7,sticker_2_8,sticker_2_9]
  },
]

import { saveAs } from "file-saver";
import html2canvas from "html2canvas";

export class CanvasFactory {
  box: Element | null;
  width: number;
  height: number;
  constructor(data: { id: string, options: {
    width: number, 
    height: number
  } }) {
    this.box = null;
    this.width = data.options.width
    this.height = data.options.height
    this._init(data.id);
  }
  _init(id: string) {
    const box = document.querySelector("#" + id);
    if (!box) {
      throw new Error("未找到元素" + id);
    }
    this.box = box;
  }
  _copyCanvas(){
    if (!this.box) return;
    const canvas = document.createElement('div')
    canvas.innerHTML = this.box.outerHTML
    const scaleWidth = canvas.firstElementChild?.getAttribute('style')?.replace(/^width: ([0-9]*)px; height: ([0-9]*)px;*/, '$1')
    if(!scaleWidth) return
    const scale = this.width / parseInt(scaleWidth)
    canvas.style.transform = `scale(${scale})`
    // canvas.style.position = 'fixed'
    // canvas.style.left = '-10000%'
    // canvas.style.top = '-10000%'
    document.body.appendChild(canvas)
    return canvas
  }
  toFile(fileType: "png" | "jpg") {
    // Error loading image : 由于image存在没有src属性的情况
    const canvas = this._copyCanvas()
    if (!canvas) return;
    html2canvas(canvas, {
      // logging: true,
      logging: false,
      width: this.width,
      height: this.height,
      scale: 1, // 默认 window.devicePixelRatio 
    })
      .then((canvas: any) => {
        canvas.toBlob(
          function (blob: Blob) {
            saveAs(blob, "image." + fileType);
          },
          fileType == "png" ? "image/png" : "image/jpeg"
        );
      });
    document.body.removeChild(canvas)
  }
}
